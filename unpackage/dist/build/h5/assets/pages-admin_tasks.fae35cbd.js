import{y as t,C as a,V as s,W as e,s as i,o as l,c as d,w as c,i as o,a as n,b as u,v as r,G as p,F as f,H as _,l as y,t as h,p as g,d as m,e as w}from"./index-a2188dbb.js";import{_ as x}from"./_plugin-vue_export-helper.1b428a4d.js";const k=x({data:()=>({userInfo:{},globalOption:{},globalData:{},admin_tasksNum:1,admin_tasks:{msg:"",status:0,success:!0,data:{list:[{id:0,user_id:0,task_id:"",prompt:"",status:"",result:"",chatype:0,created_at:"",updated_at:""}]}},cha:{msg:"",status:0,success:!0,data:{status:"",list:[{index:0,url:""}]}},user_cha:{msg:"",status:0,success:!0,data:{list:{id:0,username:"",password:"",num:0,is_admin:0,created_at:""}}},modal:""}),onShow(){this.setCurrentPage(this)},onLoad(t){this.setCurrentPage(this),t&&this.setData({globalOption:this.getOption(t)}),this.init()},methods:{async init(){await this.admin_tasksApi()},async admin_tasksApi(t){((t=t||{}).refresh||"object"!=typeof t)&&(this.admin_tasksNum=1);let a={pageNum:this.admin_tasksNum,pageSize:10},s=await this.$http.post("/admin_tasks",a,{},"json"),e=s.data.list;if(1==a.pageNum)this.admin_tasks=s;else if(e){let t=this.admin_tasks.data.list.concat(e);s.data.list=t,this.admin_tasks=s}e&&e.length>0&&(this.admin_tasksNum=this.admin_tasksNum+1),1!=s.success&&await this.showModal("查询失败，请联系管理员！"),this.navigateTo({type:"tip",tip:"查询成功！"})},async chaApi(l){let d={task_id:(l=l||{}).task_id||this.task_id,chatype:l.chatype||this.chatype};t({mask:!0,title:"加载中"});let c=await this.$http.post("/tasks/cha",d,{},"json");if(this.cha=c,a(),1!=c.success&&await this.showModal(c.msg),"succeed"==c.data.status){if(1==l.chatype)return this.navigateTo({type:"copy",copy:c.data.list[0].url,tip:""}),this.navigateTo({type:"tip",tip:"图片url已经复制到剪贴板啦！或者长按保存哦！"}),void this.navigateTo({type:"preview",img:c.data.list[0].url});if(2==l.chatype)return t({mask:!0,title:"加载中"}),void s({url:c.data.list[0].url,success:t=>{200===t.statusCode?(e({filePath:t.tempFilePath}),a(),i({title:"下载成功",icon:"success"}),this.showModal("视频url已经复制到剪贴板啦！如果没有保存成功，请自行复制到浏览器下载！")):i({title:"资源格式错误，请联系管理员"})},fail:t=>{a(),i({title:"下载失败"})}})}await this.showModal("任务可能还没有完成！当前状态"+c.data.status)},async user_chaApi(t){let a={user_id:(t=t||{}).user_id||this.user_id},s=await this.$http.post("/user/cha",a,{},"json");this.user_cha=s,this.navigateTo({type:"openmodal",id:"modal"})},stopCloseModal(t){t.stopPropagation()},closeModal(){this.modal=""}},onReachBottom(){this.admin_tasksApi()}},[["render",function(t,a,s,e,i,x){const k=m,v=o,z=w;return l(),d(v,{class:"container container333415"},{default:c((()=>[n(v,{class:"flex flex-wrap diygw-col-24 flex-direction-column flex1-clz"},{default:c((()=>[n(v,{class:"flex flex-wrap diygw-col-24 justify-between items-center flex44-clz"},{default:c((()=>[n(k,{class:"diygw-col-0 text48-clz text-red"},{default:c((()=>[u(" 内部专用 请勿外泄 ")])),_:1})])),_:1}),(l(!0),r(f,null,p(i.admin_tasks.data.list,((a,s)=>(l(),d(v,{key:s,class:"flex flex-wrap diygw-col-24 flex-direction-column flex46-clz"},{default:c((()=>[n(v,{class:"flex flex-wrap diygw-col-24 justify-between items-center flex47-clz"},{default:c((()=>[n(k,{class:"diygw-text-line2 diygw-col-24 text50-clz"},{default:c((()=>[u(h(a.prompt),1)])),_:2},1024),n(k,{class:"diygw-text-line1 diygw-col-16 text1-clz text-grey"},{default:c((()=>[u(h(a.task_id),1)])),_:2},1024),"succeed"==a.status?(l(),d(k,{key:0,class:"diygw-text-line1 diygw-col-7 text51-clz"},{default:c((()=>[u(" 已完成 ")])),_:1})):g("",!0),"submitted"==a.status?(l(),d(k,{key:1,class:"diygw-text-line1 diygw-col-7 text4-clz"},{default:c((()=>[u(" 已提交 ")])),_:1})):g("",!0),"failed"==a.status?(l(),d(k,{key:2,class:"diygw-text-line1 diygw-col-7 text3-clz"},{default:c((()=>[u(" 失败 ")])),_:1})):g("",!0),"processing"==a.status?(l(),d(k,{key:3,class:"diygw-text-line1 diygw-col-7 text2-clz"},{default:c((()=>[u(" 进行中 ")])),_:1})):g("",!0)])),_:2},1024),n(v,{class:"flex diygw-col-0"},{default:c((()=>[n(v,{class:"diygw-tag margin-xs bg-cyan",onClick:t.navigateTo,"data-type":"user_chaApi","data-user_id":a.user_id},{default:c((()=>[n(k,{class:"diygw-icon diy-icon-peoplelist"}),n(k,null,{default:c((()=>[u(h(a.user_id),1)])),_:2},1024)])),_:2},1032,["onClick","data-user_id"])])),_:2},1024),n(k,{class:"diygw-col-0"},{default:c((()=>[u(" * 点击查询该用户信息及该用户所有任务 ")])),_:1}),n(v,{class:"flex flex-wrap diygw-col-24 justify-start items-center flex48-clz"},{default:c((()=>[n(z,{onClick:t.navigateTo,"data-type":"chaApi","data-task_id":a.task_id,"data-chatype":a.chatype,class:"diygw-col-24 btn-clz diygw-btn-default"},{default:c((()=>[u("查询结果")])),_:2},1032,["onClick","data-task_id","data-chatype"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i.modal?(l(),d(v,{key:0,onTouchmove:a[0]||(a[0]=_((()=>{}),["stop","prevent"])),onClick:_(x.closeModal,["stop","prevent"]),class:y(["diygw-modal basic",i.modal]),style:{"z-index":"1000000"}},{default:c((()=>[n(v,{onClick:_(x.stopCloseModal,["stop","prevent"]),class:"diygw-dialog diygw-dialog-modal basis-lg"},{default:c((()=>[n(v,{class:"justify-end diygw-bar"},{default:c((()=>[n(v,{class:"content"},{default:c((()=>[u(h(i.user_cha.data.list.username+" 剩余点数 "+i.user_cha.data.list.num),1)])),_:1}),n(v,{class:"action","data-type":"closemodal","data-id":"modal",onClick:t.navigateTo},{default:c((()=>[n(k,{class:"diy-icon-close"})])),_:1},8,["onClick"])])),_:1}),n(v,null,{default:c((()=>[n(v,{class:"flex diygw-dialog-content"},{default:c((()=>[n(v,{class:"flex flex-wrap diygw-col-24 flex-direction-column flex2-clz"},{default:c((()=>[n(v,{class:"flex flex-wrap diygw-col-24 justify-start items-center flex5-clz"},{default:c((()=>[n(z,{onClick:t.navigateTo,"data-type":"page","data-url":"/pages/user_task","data-userid_cha":i.user_cha.data.list.id,class:"diygw-col-24 btn1-clz diygw-btn-default"},{default:c((()=>[u("查询该用户所有任务")])),_:1},8,["onClick","data-userid_cha"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1},8,["onClick","class"])):g("",!0),n(v,{class:"clearfix"})])),_:1})}],["__scopeId","data-v-82c51257"]]);export{k as default};
