import{y as t,C as a,V as s,W as e,s as l,o as i,c as d,w as c,i as o,a as n,b as u,v as p,G as f,F as r,H as y,l as h,t as _,p as g,d as m,e as w}from"./index-a2188dbb.js";import{_ as x}from"./_plugin-vue_export-helper.1b428a4d.js";const k=x({data:()=>({userInfo:{},globalOption:{},globalData:{},cha:{msg:"",status:0,success:!0,data:{status:"",list:[{index:0,url:""}]}},admin_tasksNum:1,admin_tasks:{msg:"",status:0,success:!0,data:{list:[{id:0,user_id:0,task_id:"",prompt:"",status:"",result:"",chatype:0,created_at:"",updated_at:""}]}},modal:""}),onShow(){this.setCurrentPage(this)},onLoad(t){this.setCurrentPage(this),t&&this.setData({globalOption:this.getOption(t)}),this.init()},methods:{async init(){await this.admin_tasksApi()},async chaApi(i){let d={task_id:(i=i||{}).task_id||this.task_id,chatype:i.chatype||this.chatype};t({mask:!0,title:"加载中"});let c=await this.$http.post("/tasks/cha",d,{},"json");if(this.cha=c,a(),1!=c.success&&await this.showModal(c.msg),"succeed"==c.data.status){if(1==i.chatype)return this.navigateTo({type:"copy",copy:c.data.list[0].url,tip:""}),this.navigateTo({type:"tip",tip:"图片url已经复制到剪贴板啦！或者长按保存哦！"}),void this.navigateTo({type:"preview",img:c.data.list[0].url});if(2==i.chatype)return t({mask:!0,title:"加载中"}),void s({url:c.data.list[0].url,success:t=>{200===t.statusCode?(e({filePath:t.tempFilePath}),a(),l({title:"下载成功",icon:"success"}),this.showModal("视频url已经复制到剪贴板啦！如果没有保存成功，请自行复制到浏览器下载！")):l({title:"资源格式错误，请联系管理员"})},fail:t=>{a(),l({title:"下载失败"})}})}await this.showModal("任务可能还没有完成！当前状态"+c.data.status)},async admin_tasksApi(t){((t=t||{}).refresh||"object"!=typeof t)&&(this.admin_tasksNum=1);let a={pageNum:this.admin_tasksNum,pageSize:10,user_id:t.user_id||this.globalOption.userid_cha},s=await this.$http.post("/admin_tasks",a,{},"json"),e=s.data.list;if(1==a.pageNum)this.admin_tasks=s;else if(e){let t=this.admin_tasks.data.list.concat(e);s.data.list=t,this.admin_tasks=s}e&&e.length>0&&(this.admin_tasksNum=this.admin_tasksNum+1),1!=s.success&&await this.showModal("查询失败，请联系管理员！"),this.navigateTo({type:"tip",tip:"查询成功！"})},stopCloseModal(t){t.stopPropagation()},closeModal(){this.modal=""}},onReachBottom(){this.admin_tasksApi()}},[["render",function(t,a,s,e,l,x){const k=m,z=o,v=w;return i(),d(z,{class:"container container333415"},{default:c((()=>[n(z,{class:"flex flex-wrap diygw-col-24 flex-direction-column flex1-clz"},{default:c((()=>[n(z,{class:"flex flex-wrap diygw-col-24 justify-between items-center flex44-clz"},{default:c((()=>[n(k,{class:"diygw-col-0 text48-clz text-red"},{default:c((()=>[u(" 内部专用 请勿外泄 ")])),_:1})])),_:1}),(i(!0),p(r,null,f(l.admin_tasks.data.list,((a,s)=>(i(),d(z,{key:s,class:"flex flex-wrap diygw-col-24 flex-direction-column flex46-clz"},{default:c((()=>[n(z,{class:"flex flex-wrap diygw-col-24 justify-between items-center flex47-clz"},{default:c((()=>[n(k,{class:"diygw-text-line2 diygw-col-24 text50-clz"},{default:c((()=>[u(_(a.prompt),1)])),_:2},1024),n(k,{class:"diygw-text-line1 diygw-col-16 text1-clz text-grey"},{default:c((()=>[u(_(a.task_id),1)])),_:2},1024),n(k,{class:"diygw-text-line1 diygw-col-7 text51-clz"},{default:c((()=>[u(_(a.status),1)])),_:2},1024)])),_:2},1024),n(z,{class:"flex flex-wrap diygw-col-24 justify-start items-center flex48-clz"},{default:c((()=>[n(v,{onClick:t.navigateTo,"data-type":"chaApi","data-task_id":a.task_id,"data-chatype":a.chatype,class:"diygw-col-24 btn-clz diygw-btn-default"},{default:c((()=>[u("查询结果")])),_:2},1032,["onClick","data-task_id","data-chatype"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),l.modal?(i(),d(z,{key:0,onTouchmove:a[0]||(a[0]=y((()=>{}),["stop","prevent"])),onClick:y(x.closeModal,["stop","prevent"]),class:h(["diygw-modal basic",l.modal]),style:{"z-index":"1000000"}},{default:c((()=>[n(z,{onClick:y(x.stopCloseModal,["stop","prevent"]),class:"diygw-dialog diygw-dialog-modal basis-lg"},{default:c((()=>[n(z,{class:"justify-end diygw-bar"},{default:c((()=>[n(z,{class:"content"},{default:c((()=>[u(_(t.user_cha.data.list.username+" 剩余点数 "+t.user_cha.data.list.num),1)])),_:1}),n(z,{class:"action","data-type":"closemodal","data-id":"modal",onClick:t.navigateTo},{default:c((()=>[n(k,{class:"diy-icon-close"})])),_:1},8,["onClick"])])),_:1}),n(z,null,{default:c((()=>[n(z,{class:"flex diygw-dialog-content"},{default:c((()=>[(i(!0),p(r,null,f(t.tasks.data.list,((a,s)=>(i(),d(z,{key:s,class:"flex flex-wrap diygw-col-24 flex-direction-column flex2-clz"},{default:c((()=>[n(z,{class:"flex flex-wrap diygw-col-24 justify-between items-center flex4-clz"},{default:c((()=>[n(k,{class:"diygw-text-line2 diygw-col-24 text2-clz"},{default:c((()=>[u(_(a.prompt),1)])),_:2},1024),n(k,{class:"diygw-text-line1 diygw-col-16 text3-clz text-grey"},{default:c((()=>[u(_(a.task_id),1)])),_:2},1024),n(k,{class:"diygw-text-line1 diygw-col-7 text6-clz"},{default:c((()=>[u(_(a.status),1)])),_:2},1024)])),_:2},1024),n(z,{class:"flex flex-wrap diygw-col-24 justify-start items-center flex5-clz"},{default:c((()=>[n(v,{onClick:t.navigateTo,"data-type":"chaApi","data-task_id":a.task_id,"data-chatype":a.chatype,class:"diygw-col-24 btn1-clz diygw-btn-default"},{default:c((()=>[u("查询结果")])),_:2},1032,["onClick","data-task_id","data-chatype"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1},8,["onClick","class"])):g("",!0),n(z,{class:"clearfix"})])),_:1})}],["__scopeId","data-v-c5384d02"]]);export{k as default};
