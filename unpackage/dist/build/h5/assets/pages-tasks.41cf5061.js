import{y as t,C as s,V as a,W as e,s as i,o as l,c,w as d,i as o,a as u,b as n,v as p,G as h,F as f,d as r,t as y,p as g,e as w}from"./index-a2188dbb.js";import{_ as x}from"./_plugin-vue_export-helper.1b428a4d.js";const k=x({data:()=>({userInfo:{},globalOption:{},globalData:{},tasksNum:1,tasks:{msg:"",status:0,success:!0,data:{list:[{id:0,user_id:0,task_id:"",prompt:"",status:"",result:"",chatype:0,created_at:"",updated_at:""}]}},cha:{msg:"",status:0,success:!0,data:{status:"",list:[{index:0,url:""}]}}}),onShow(){this.setCurrentPage(this)},onLoad(t){this.setCurrentPage(this),t&&this.setData({globalOption:this.getOption(t)}),this.init()},methods:{async init(){await this.tasksApi()},async tasksApi(t){((t=t||{}).refresh||"object"!=typeof t)&&(this.tasksNum=1);let s={pageNum:this.tasksNum,pageSize:10},a=await this.$http.post("/tasks",s,{},"json"),e=a.data.list;if(1==s.pageNum)this.tasks=a;else if(e){let t=this.tasks.data.list.concat(e);a.data.list=t,this.tasks=a}e&&e.length>0&&(this.tasksNum=this.tasksNum+1),1!=a.success&&await this.showModal("查询失败，请联系管理员！"),this.navigateTo({type:"tip",tip:"查询成功！"})},async chaApi(l){let c={task_id:(l=l||{}).task_id||this.task_id,chatype:l.chatype||this.chatype};t({mask:!0,title:"加载中"});let d=await this.$http.post("/tasks/cha",c,{},"json");if(this.cha=d,s(),1!=d.success&&await this.showModal(d.msg),"succeed"==d.data.status){if(1==l.chatype)return this.navigateTo({type:"copy",copy:d.data.list[0].url,tip:""}),this.navigateTo({type:"tip",tip:"图片url已经复制到剪贴板啦！或者长按保存哦！"}),void this.navigateTo({type:"preview",img:d.data.list[0].url});if(2==l.chatype)return t({mask:!0,title:"加载中"}),void a({url:d.data.list[0].url,success:t=>{200===t.statusCode?(e({filePath:t.tempFilePath}),s(),i({title:"下载成功",icon:"success"}),this.showModal("视频url已经复制到剪贴板啦！如果没有保存成功，请自行复制到浏览器下载！")):i({title:"资源格式错误，请联系管理员"})},fail:t=>{s(),i({title:"下载失败"})}})}await this.showModal("任务可能还没有完成！当前状态"+d.data.status)}},onReachBottom(){this.tasksApi()}},[["render",function(t,s,a,e,i,x){const k=r,_=o,m=w;return l(),c(_,{class:"container container333415"},{default:d((()=>[u(_,{class:"flex flex-wrap diygw-col-24 flex-direction-column flex1-clz"},{default:d((()=>[u(_,{class:"flex flex-wrap diygw-col-24 justify-between items-center flex44-clz"},{default:d((()=>[u(k,{class:"diygw-col-0 text48-clz text-red"},{default:d((()=>[n(" 内部专用 请勿外泄 ")])),_:1})])),_:1}),(l(!0),p(f,null,h(i.tasks.data.list,((s,a)=>(l(),c(_,{key:a,class:"flex flex-wrap diygw-col-24 flex-direction-column flex46-clz"},{default:d((()=>[u(_,{class:"flex flex-wrap diygw-col-24 justify-between items-center flex47-clz"},{default:d((()=>[u(k,{class:"diygw-text-line2 diygw-col-24 text50-clz"},{default:d((()=>[n(y(s.prompt),1)])),_:2},1024),u(k,{class:"diygw-text-line1 diygw-col-16 text-clz text-grey"},{default:d((()=>[n(y(s.task_id),1)])),_:2},1024),"succeed"==s.status?(l(),c(k,{key:0,class:"diygw-text-line1 diygw-col-7 text51-clz"},{default:d((()=>[n(" 已完成 ")])),_:1})):g("",!0),"failed"==s.status?(l(),c(k,{key:1,class:"diygw-text-line1 diygw-col-7 text3-clz"},{default:d((()=>[n(" 失败 ")])),_:1})):g("",!0),"processing"==s.status?(l(),c(k,{key:2,class:"diygw-text-line1 diygw-col-7 text2-clz"},{default:d((()=>[n(" 进行中 ")])),_:1})):g("",!0),"submitted"==s.status?(l(),c(k,{key:3,class:"diygw-text-line1 diygw-col-7 text1-clz"},{default:d((()=>[n(" 已提交 ")])),_:1})):g("",!0)])),_:2},1024),u(_,{class:"flex flex-wrap diygw-col-24 justify-start items-center flex48-clz"},{default:d((()=>[u(m,{onClick:t.navigateTo,"data-type":"chaApi","data-task_id":s.task_id,"data-chatype":s.chatype,class:"diygw-col-24 btn-clz diygw-btn-default"},{default:d((()=>[n("查询结果")])),_:2},1032,["onClick","data-task_id","data-chatype"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),u(_,{class:"clearfix"})])),_:1})}],["__scopeId","data-v-3d3f2d52"]]);export{k as default};
